
//  Park NPCs in deArnise Keep

//  Branwen SoA

EXTEND_BOTTOM O#BRANP 1
IF ~G("RjaliBranwenScout",2)
    G("O#BranRomanceActive",2)
    !G("KeepPlot",0)~ THEN REPLY @0 GOTO RJParkBranwenSOA
END

APPEND O#BRANP

IF ~~ THEN BEGIN RJParkBranwenSOA
  SAY @10
  IF ~~ THEN DO ~SetGlobal("RJParkBR","GLOBAL",1)
                 IncrementGlobal("RJCntParked","GLOBAL",1)
                 EscapeAreaMove("AR1307",629,440,2)~ EXIT
END

IF WEIGHT #-1 ~G("RJParkBR",1)~ THEN BEGIN RJVisitBranwenSOA
  SAY @12
  IF ~~ THEN REPLY @13 EXIT
  IF ~~ THEN REPLY @7 DO ~
                 SetGlobal("RJParkBR","GLOBAL",0)
                 IncrementGlobal("RJCntParked","GLOBAL",-1)
                 JoinParty()~ EXIT
  IF ~RandomNum(3,1)~ THEN REPLY @9 GOTO RJVBRSOA1
  IF ~RandomNum(3,2)~ THEN REPLY @9 GOTO RJVBRSOA2
  IF ~RandomNum(3,3)~ THEN REPLY @9 GOTO RJVBRSOA3
  IF ~~ THEN REPLY @11 GOTO RJVBRSOA4
  IF ~~ THEN REPLY @390 GOTO RJVBRSOA5
  IF ~~ THEN REPLY @8 GOTO RJVBRSOA6
END

IF ~~ THEN BEGIN RJVBRSOA1
  SAY @391 = @392 = @393
  IF ~~ THEN REPLY @394 EXIT
END

IF ~~ THEN BEGIN RJVBRSOA2
  SAY @395 = @396
  IF ~~ THEN REPLY @397 EXIT
END

IF ~~ THEN BEGIN RJVBRSOA3
  SAY @398 = @399
  IF ~~ THEN REPLY @400 EXIT
END

IF ~~ THEN BEGIN RJVBRSOA4
  SAY @401 = @402 = @403
  IF ~~ THEN REPLY @404 EXIT
END

IF ~~ THEN BEGIN RJVBRSOA5
  SAY @405 = @406
  IF ~~ THEN REPLY @407 EXIT
END

IF ~~ THEN BEGIN RJVBRSOA6
  SAY @408 = @409
  IF ~~ THEN REPLY @410 EXIT
END

END

//   Branwen ToB

EXTEND_BOTTOM O#BRA25P 0
IF ~G("O#BranRomanceActive",2)~ THEN REPLY @0 GOTO RJParkBranwenTOB
END

APPEND O#BRA25P

IF ~~ THEN BEGIN RJParkBranwenTOB
  SAY @10
  IF ~~ THEN DO ~SetGlobal("RJParkBR","GLOBAL",1)
                 IncrementGlobal("RJCntParked","GLOBAL",1)
                 EscapeAreaMove("AR1307",629,440,2)~ EXIT
END

IF WEIGHT #-1 ~G("RJParkBR",1)~ THEN BEGIN RJVisitBranwenTOB
  SAY @12
  IF ~G("RJFinalVisit",1) G("RJBRFV",0)~ THEN REPLY @14 GOTO RJVBRTOB9
  IF ~~ THEN REPLY @13 EXIT
  IF ~~ THEN REPLY @7 DO ~
                 SetGlobal("RJParkBR","GLOBAL",0)
                 IncrementGlobal("RJCntParked","GLOBAL",-1)
                 JoinParty()~ EXIT
  IF ~RandomNum(3,1) G("RJCHAP01",1)~ THEN REPLY @9 GOTO RJVBRTOB1.1
  IF ~RandomNum(3,1) G("RJCHAP01",0)~ THEN REPLY @9 GOTO RJVBRTOB1.2
  IF ~RandomNum(3,2)~ THEN REPLY @9 GOTO RJVBRTOB2
  IF ~RandomNum(3,3)~ THEN REPLY @9 GOTO RJVBRTOB3
  IF ~~ THEN REPLY @11 GOTO RJVBRTOB4
  IF ~~ THEN REPLY @420 GOTO RJVBRTOB5
  IF ~~ THEN REPLY @8 GOTO RJVBRTOB6
END

IF ~~ THEN BEGIN RJVBRTOB1.1
  SAY @424 = @425 = @426
  IF ~~ THEN REPLY @427 EXIT
END

IF ~~ THEN BEGIN RJVBRTOB1.2
  SAY @450 = @451
  IF ~~ THEN REPLY @452 EXIT
END

IF ~~ THEN BEGIN RJVBRTOB2
  SAY @428
  IF ~~ THEN REPLY @429 EXIT
END

IF ~~ THEN BEGIN RJVBRTOB3
  SAY @430 = @431
  IF ~~ THEN REPLY @432 EXIT
END

IF ~~ THEN BEGIN RJVBRTOB4
  SAY @433 = @434
  IF ~~ THEN REPLY @435 EXIT
END

IF ~~ THEN BEGIN RJVBRTOB5
  SAY @436 = @437 = @438 = @439
  IF ~~ THEN REPLY @440 EXIT
END

IF ~~ THEN BEGIN RJVBRTOB6
  SAY @421 = @422
  IF ~~ THEN REPLY @423 EXIT
END

IF ~~ THEN BEGIN RJVBRTOB9
  SAY @441 = @442
  IF ~~ THEN REPLY @443 GOTO RJVBRTOB9.1
END

IF ~~ THEN BEGIN RJVBRTOB9.1
  SAY @444 = @445
  IF ~~ THEN REPLY @446 GOTO RJVBRTOB9.2
END

IF ~~ THEN BEGIN RJVBRTOB9.2
  SAY @447 = @448
  IF ~~ THEN REPLY @449 DO ~SetGlobal("RJBRFV","GLOBAL",1)~ EXIT
END

END
